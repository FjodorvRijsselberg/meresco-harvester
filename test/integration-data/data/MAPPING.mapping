<?xml version="1.0"?>
<mapping>
  <id>MAPPING</id>
  <name>default</name>
  <description>This mapping is what has become the default mapping for most Meresco based projects.
</description>
  <code>upload.parts['metadata'] = lxmltostring(xpathFirst(upload.record, 'oai:metadata'))

upload.parts['header'] = lxmltostring(xpathFirst(upload.record, 'oai:header'))

upload.parts['meta'] = """&lt;meta xmlns="http://meresco.org/namespace/harvester/meta"&gt;
  &lt;upload&gt;&lt;id&gt;%(id)s&lt;/id&gt;&lt;/upload&gt;
  &lt;record&gt;
    &lt;id&gt;%(recordId)s&lt;/id&gt;
  &lt;/record&gt;
  &lt;repository&gt;
    &lt;id&gt;%(repository)s&lt;/id&gt;
    &lt;set&gt;%(set)s&lt;/set&gt;
    &lt;baseurl&gt;%(baseurl)s&lt;/baseurl&gt;
    &lt;repositoryGroupId&gt;%(repositoryGroupId)s&lt;/repositoryGroupId&gt;
    &lt;metadataPrefix&gt;%(metadataPrefix)s&lt;/metadataPrefix&gt;
    &lt;collection&gt;%(collection)s&lt;/collection&gt;
  &lt;/repository&gt;
&lt;/meta&gt;""" % dict([(k,xmlEscape(v)) for k,v in {
  'id': upload.id,
  'set': upload.repository.set,
  'baseurl': upload.repository.baseurl,
  'repositoryGroupId':  upload.repository.repositoryGroupId,
  'repository': upload.repository.id,
  'metadataPrefix': upload.repository.metadataPrefix,
  'collection': upload.repository.collection,
  'recordId': upload.recordIdentifier,
}.items()])
</code>
</mapping>

<p>
<h3>Harvester Status.</h3>
</p>
<%
domainId = args.domainId
args = urlencode(dict(domainId=domainId, repositoryGroupId=args.repositoryGroupId, repositoryId=args.repositoryId))
theUrl = url('/getStatus?%s' % args)

statuses = asxml(theUrl).saharaget.GetStatus.status

statusUrl = url('%s/getStatus?%s' % (req.get_options()['dynamicHtmlUrl'], args))
ignored = {}
for status in asxml(statusUrl).saharaget.GetStatus.status:
    ignored[status.repositoryId] = status
#
%>
<table class="event">
<tr class="eventheader">
<td>RepositoryGroup</td>
<td>Repository</td>
<td>Last successful harvest</td>
<td>Total records</td>
<td>Harvested<br>Uploaded<br>Deleted</td>
<td>#Errors</td>
<td></td>
<td>#Ignores</td>
<td></td>
</tr>
<%
for status in statuses:
  total = 0
  total += int(str(status.total) or '0')
  errorsnr = int(str(status.totalerrors))
  style = errorsnr and 'style="font-weight:bold"' or ''
%>
<tr>
<td <%=style%>><% escape_xml(status.repositoryGroupId) %></td>
<td <%=style%>><% escape_html(status.repositoryId) %></td>
<td <%=style%>><% escape_html(status.lastHarvestDate) %></td>
<td><% escape_html(status.total) %></td>
<td><% escape_html(status.harvested) %>/<% escape_html(status.uploaded) %>/<% escape_html(status.deleted) %></td>
<td><% escape_html(status.totalerrors) %></td>
<%
  if errorsnr:
%>
<td class="error"><a name="top_<%= status.repositoryId %>" href="#<%= status.repositoryId %>">Errors</a></td>
<%
  else:
%>
<td>&nbsp;</td>
<% 
  #
%>
<td><% escape_html(ignored[status.repositoryId].ignored if status.repositoryId in ignored else 0) %></td>
<td class="ignored">
<%
  if status.repositoryId in ignored:
    args = urlencode(dict(domainId=domainId, repositoryId=status.repositoryId))
%>
    <a href="<%= req.get_options()['dynamicHtmlUrl'] %>/page/ignored?<%= args %>">Ignored</a>
<%
  #
%>
</td>
</tr>
<%
#
%>
</table>
<br>

<p>
<h3>Harvester Errors.</h3>
</p>
<table class="event">
<%
for status in statuses:
  repositoryId = status.repositoryId
  errorsnr = int(str(status.totalerrors))
  if errorsnr:
    #
%>
<tr class="eventinfo">
<td><a name="<%= repositoryId %>" href="#top_<%= repositoryId %>"><%= repositoryId %></a></td>
<td>Last successful harvest</td>
<td><%= status.lastHarvestDate %></td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Nr. of errors since:</td>
<td><b><%= errorsnr %></b></td>
</tr>
<%
    if hasattr(status.recenterrors, 'error'):
      for error in status.recenterrors.error:
        #
%>
  <tr class="eventerror">
    <td>&nbsp;</td>
    <td class="alt"><%= error.date %></td>
    <td class="alt"><% escape_html(error.split('|')[-1]) %></td>
  </tr>
<%
#
%>
</table>

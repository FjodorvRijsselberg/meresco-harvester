<%
users = xpath(aslxml(url('/users.xml')), '/users/child::*')
ATTRS = ['name', 'organization', 'telephone', 'email', 'domain', 'notes']
f = asform(input)
target(filepath('users.xml'))
%><?xml version ="1.0" encoding="UTF-8"?>
<users>
<%
for user in users:
  username = user.tag.split('}')[-1]
  userdict = {}
  for attr in ATTRS:
    value = xpathFirst(user, '%s/text()' % attr)
    userdict[attr] = '' if value is None else value

  if username == f.user:
    for attr in ATTRS:
      userdict[attr] = f.get(attr, '')
  #
%>
<<%escape_xml(username)%>>
<%
  for attr in ATTRS:
    #
%>    <<%=attr%>><%escape_xml(userdict[attr])%></<%=attr%>>
<%
  # end for attr in ..
%>
</<%escape_xml(username)%>>
<%
#
%>
</users>
<%
redirect('/page/domains/show')
%>

<%
from meresco.harvester.harvester.mapping import Mapping
import os

f = asform(input)
code = str(f.code).replace('\r','')

target(filepath(f.id + '.mapping'))
%><?xml version="1.0"?>
<mapping>
  <id><%=f.id%></id>
  <name><%escape_xml(f.name)%></name>
  <description><%escape_xml(f.description)%></description>
  <code><%escape_xml(code)%></code>
</mapping>
<%
error = ''
if not f.name:
  error = 'Geen naam ingevoerd'
else:
  datamap = Mapping(str(f.id))
  datamap.code=code
  try:
    datamap.validate()
  except Exception, e:
    error = str(e)
redirect(uri(path='/page/mapping.edit/'+f.id+'.mapping', query={'error':error, 'referrerDomain':f.referrerDomain}))
%>
